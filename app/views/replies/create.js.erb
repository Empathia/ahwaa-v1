<% if @reply.valid? %>
  if($('#comments_<%= @reply.contextual_index %>').length == 0) {
    $('.container').append('<%= escape_javascript render(:partial => 'topics/comments', :object => [[@reply.contextual_index, @reply]]) %>');
  } else {
    $('#comments_<%= @reply.contextual_index %> ul').append('<%= escape_javascript render(@reply) %>');
  }
  $('#add_<%= @reply.contextual_index %>').addClass('has_comments').removeClass('no_comments').trigger('click');
  setTimeout(function() {
    $('#add_<%= @reply.contextual_index %>').trigger('click');
  }, 500);
<% else %>
  $('.response-wrapper:visible .error').text("<%= @reply.errors.full_messages.first %>");
<% end %>
