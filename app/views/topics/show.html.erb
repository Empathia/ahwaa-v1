<% javascript 'locales', 'comments', 'slideshow', 'sitescript' %>
<% stylesheet 'topics' %>
<div class="aligned">
  <div class="content">
    <article class="border-all">
      <header>
      <h1><%= @topic.title %></h1>
        <div class="avatar">
          <%= image_tag @topic.user.profile.avatar.url, :width => '50' %>
        </div>
        <p class="article-tags">
          <%= linked_tag_list @topic.tags %>
        </p>
      </header>
      <div class="topic-content">
        <%= simple_format @topic.content %>
      </div>
      <div class="social-bookmarkers border-left">
        <%= link_to t('.icons.social.facebook'), facebook_share_url(@topic), :target => "_blank", :class => 'facebook' %>
        <%= link_to t('.icons.social.twitter'), twitter_share_url(@topic), :target => "_blank", :class => 'twitter' %>
      </div>
    </article>
    <section class="related-content border-all">
      <h2 class="regular divide" style="border-bottom: 1px solid #e5e5e5"><%= t('.related_content.title') %></h2>
      <div class="arrows">
        <span class="back"><%= t('.related_content.arrows.back') %></span>
      </div>
      <div class="related-carrousel">
        <ul>
          <li>
            <%= link_to image_tag('no-image.jpg', :width => '50'), nil, :class => "avatar" %>
            <%= link_to 'How to accept his way son?' %></li>
          <li>
            <%= link_to image_tag('no-image.jpg', :width => '50'), nil, :class => "avatar" %>
            <%= link_to 'Interview with gay son and his parents' %>
          </li>
          <li>
            <%= link_to image_tag('no-image.jpg', :width => '50'), nil, :class => "avatar" %>
            <%= link_to 'Gallery of some common theme' %></li>
          <li>
            <%= link_to image_tag('no-image.jpg', :width => '50'), nil, :class => "avatar" %>
            <%= link_to 'History of son run of his home' %>
          </li>
        </ul>
      </div>
      <div class="arrows">
        <span class="next"><%= t('.related_content.arrows.next') %></span>
      </div>
    </section>
  </div>
  <aside class="border-right">
    <section>
      <%= link_to t('.sidebar.hide_all_responses'), nil, :class => "expand-btn btn-gradient hide" %>
    </section>
    <section>
      <h2 class="regular"><%= t('.sidebar.filter_responses.title') %></h2>
      <ul class="filter-resposes">
        <% Reply::CATEGORIES.each do |category| %>
          <li>
            <%= check_box_tag :filter_category, category %>
            <label class="<%= category %>"><%= t("activemodel.attributes.reply.categories.#{category}") %></label>
          </li>
        <% end %>
      </ul>
    </section>
    <section>
      <%= check_box_tag :filter_helpful %>
      <label for="" id="helpful-comms"><%= t('.sidebar.filter_helpful') %></label>
    </section>
    <section>
      <h2><%= t('.sidebar.experts.title') %></h2>
      <ul class="topic-experts">
        <% @topic.leaderboard.each do |user| %>
          <li>
            <div class="avatar">
              <%= image_tag user.profile.avatar.url, :width => '50' %>
            </div>
            <%= link_to user.username %>
            <div class="private-msg">
              <div class="expert-wrapper">
                <div class="expert-info">
                  <p><%= link_to 'Taxxodium' %> <%= t('.sidebar.experts.expert') %></p>
                  <p><%= t('.sidebar.experts.points', {:points => 150})%></p>
                  <a href="#" class="btn-gradient send-private-msg"><%= t('.sidebar.experts.send_msg') %></a>
                </div>  
                <div class="avatar">
                  <%= image_tag user.profile.avatar.url, :width => '50' %>  
                </div>
              </div>                              
              <form action="#" method="post" class="form-private-msg">
                <textarea class="border-all"></textarea>
                <div class="private-msg-btns">
                  <input type="button" class="cancel btn-gradient" value="<%= t('.sidebar.experts.cancel') %>">
                  <input type="submit" class="btn-gradient" value="<%= t('.sidebar.experts.submit') %>">
                </div>
              </form>   
              <div class="recently-topics">
                <p><%= t('.sidebar.experts.recently_participated') %></p>
                <ul>
                  <li><%= link_to "I'm Bisexual will i go to hell? (Christians say th..." %></li>
                  <li><%= link_to "Do you have 1 partner or do you have a seco..." %></li>
                  <li><%= link_to "How do I make friends in my currently situati..." %></li>
                </ul>
              </div>
            </div>
          </li>
        <% end %>
      </ul>
    </section>
    <section>
      <%= link_to t('.sidebar.need_help'), '#', :class => "help" %>
    </section>
  </aside>
</div>
<form id="add_comments" class="add_comments border-all" action="#">
  <div>
    <div><%= link_to 'navidsafa', '#'%><%= link_to t('.reply_form.cancel'), '#', :class => 'cancel-comment' %></div>
    <textarea placeholder="<%= t('.reply_form.write_response') %>"></textarea>           
    <div class="res-types-wrapper">
      <div>
        <ul class="res-types">
           <% Reply::CATEGORIES.each_with_index do |category, i| %>
              <li>
                <input type="submit" value="<%= t("activemodel.attributes.reply.categories.#{category}") %>" name="<%= category %>" class="res-type <%= i == 0 ? 'border-left' : (i == Reply::CATEGORIES.length-1 ? 'border-right' : '')%>">
              </li>
            <% end %>
        </ul>
        <label class="res-lbl"><%= t('.reply_form.type_response') %></label>
      </div>
    </div>
  </div>
</form>
<% @replies.each do |index, replies| %>
  <div class="comments" id="comments_<%= index %>">
    <ul>
      <% replies.each do |reply| %>
        <%= content_tag :li, :class => ("expert" if reply.from_expert?) do %>
          <div>
            <div class="avatar-wrapper">
              <span class="avatar">
                <%= image_tag reply.autor_avatar, :width => '50' %>
              </span>                  
              <div>
                <div class="res-username">
                  <% unless reply.anonymous? %>
                    <%= link_to reply.user.username %>
                  <% else %>
                    <%= t(".replies.anonymous") %>
                  <% end %>       
                </div>      
                <div class="res-flag-btns">
                  <a href="#" class="btn-gradient useful">This was useful!</a>
                  <a href="#" class="btn-gradient flag">Flag</a>
                </div>
              </div>
              <div class="res-type-wrapper">
                <div>
                  <div>                                    
                    <div class="topic-res-type advice"><%=  reply.i18n_category %></div>
                  </div>
                </div>
              </div>
            </div>
            <%= simple_format reply.content %>
            <% if reply.replies.size > 0 %>
              <ul>
              <% reply.replies.each do |reply_reply| %>
                <li>
                  <div>
                    <div class="avatar-wrapper">
                      <span class="avatar">
                        <%= image_tag reply_reply.autor_avatar, :width => '50' %>
                      </span>
                      <% unless reply_reply.anonymous? %>
                        <%= link_to reply_reply.user.username %>
                      <% else %>
                        <%= t(".replies.anonymous") %>
                      <% end %>                      
                    </div>
                    <%= simple_format reply_reply.content %>
                  </div>
                </li>
              <% end %>
              </ul>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </ul>      
    <div class="new-response">
      <div>
        <a href="#"><%= t('.reply_form.new_response') %></a>
      </div>
    </div>
  </div>
<% end %>
